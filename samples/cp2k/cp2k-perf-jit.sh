#!/bin/sh

HERE=$(cd $(dirname $0); pwd -P)
ECHO=$(which echo)
FILE=cp2k-perf.txt

RUNS0="5_5_5 5_5_13 5_5_24 5_5_26 5_5_32 5_13_5 5_13_13 5_13_24 5_13_26 5_13_32 5_24_5 5_24_13 5_24_24 5_24_26 5_24_32 5_26_5 5_26_13 5_26_24 5_26_26 5_26_32 5_32_5 5_32_13 5_32_24 5_32_26 5_32_32 6_6_6 7_7_7 7_7_13 7_7_25 7_7_32 7_13_7 7_13_13 7_13_25 7_13_32 7_25_7 7_25_13 7_25_25 7_25_32 7_32_7 7_32_13 7_32_25 7_32_32 9_9_9 9_9_22 9_9_32 9_22_9 9_22_22 9_22_32 9_32_9 9_32_22 9_32_32 12_12_12 13_5_5 13_5_13 13_5_24 13_5_26 13_5_32 13_7_7 13_7_13 13_7_25 13_7_32 13_13_5 13_13_7 13_13_13 13_13_24 13_13_25 13_13_26 13_13_28 13_13_32 13_13_45 13_24_5 13_24_13 13_24_24 13_24_26 13_24_32 13_25_7 13_25_13 13_25_25 13_25_32 13_26_5 13_26_13 13_26_24 13_26_26 13_26_28 13_26_32 13_26_45 13_28_13 13_28_26 13_28_28 13_28_32 13_28_45 13_32_5 13_32_7 13_32_13 13_32_24 13_32_25 13_32_26 13_32_28 13_32_32 13_32_45 13_45_13 13_45_26 13_45_28 13_45_32 13_45_45 14_14_14 14_14_16 14_14_29 14_14_32 14_16_14 14_16_16 14_16_29 14_29_14 14_29_16 14_29_29 14_29_32 14_32_14 14_32_29 14_32_32 16_14_14 16_14_16 16_14_29 16_16_14 16_16_16 16_16_29 16_16_55 16_29_14 16_29_16 16_29_29 16_29_55 16_55_16 16_55_29 16_55_55 22_9_9 22_9_22 22_9_32 22_22_9 22_22_22 22_22_32 22_32_9 22_32_22 22_32_32 23_23_23 24_5_5 24_5_13 24_5_24 24_5_26 24_5_32 24_13_5 24_13_13 24_13_24 24_13_26 24_13_32 24_24_5 24_24_13 24_24_24 24_24_26 24_24_32 24_26_5 24_26_13 24_26_24 24_26_26 24_26_32 24_32_5 24_32_13 24_32_24 24_32_26 24_32_32 25_7_7 25_7_13 25_7_25 25_7_32 25_13_7 25_13_13 25_13_25 25_13_32 25_25_7 25_25_13 25_25_25 25_25_32 25_32_7 25_32_13 25_32_25 25_32_32 26_5_5 26_5_13 26_5_24 26_5_26 26_5_32 26_13_5 26_13_13 26_13_24 26_13_26 26_13_28 26_13_32 26_13_45 26_24_5 26_24_13 26_24_24 26_24_26 26_24_32 26_26_5 26_26_13 26_26_24 26_26_26 26_26_28 26_26_32 26_26_45 26_28_13 26_28_26 26_28_28 26_28_32 26_28_45 26_32_5 26_32_13 26_32_24 26_32_26 26_32_28 26_32_32 26_32_45 26_45_13 26_45_26 26_45_28 26_45_32 26_45_45 28_13_13 28_13_26 28_13_28 28_13_32 28_13_45 28_26_13 28_26_26 28_26_28 28_26_32 28_26_45 28_28_13 28_28_26 28_28_28 28_28_32 28_28_45 28_32_13 28_32_26 28_32_28 28_32_32 28_32_45 28_45_13 28_45_26 28_45_28 28_45_32 28_45_45 29_14_14 29_14_16 29_14_29 29_14_32 29_16_14 29_16_16 29_16_29 29_16_55 29_29_14 29_29_16 29_29_29 29_29_32 29_29_55 29_32_14 29_32_29 29_32_32 29_32_55 29_55_16 29_55_29 29_55_32 29_55_55 32_5_5 32_5_13 32_5_24 32_5_26 32_5_32 32_7_7 32_7_13 32_7_25 32_7_32 32_9_9 32_9_22 32_9_32 32_13_5 32_13_7 32_13_13 32_13_24 32_13_25 32_13_26 32_13_28 32_13_32 32_13_45 32_14_14 32_14_29 32_14_32 32_22_9 32_22_22 32_22_32 32_24_5 32_24_13 32_24_24 32_24_26 32_24_32 32_25_7 32_25_13 32_25_25 32_25_32 32_26_5 32_26_13 32_26_24 32_26_26 32_26_28 32_26_32 32_26_45 32_28_13 32_28_26 32_28_28 32_28_32 32_28_45 32_29_14 32_29_29 32_29_32 32_29_55 32_32_5 32_32_7 32_32_9 32_32_13 32_32_14 32_32_22 32_32_24 32_32_25 32_32_26 32_32_28 32_32_29 32_32_32 32_32_45 32_32_55 32_45_13 32_45_26 32_45_28 32_45_32 32_45_45 32_55_29 32_55_32 32_55_55 45_13_13 45_13_26 45_13_28 45_13_32 45_13_45 45_26_13 45_26_26 45_26_28 45_26_32 45_26_45 45_28_13 45_28_26 45_28_28 45_28_32 45_28_45 45_32_13 45_32_26 45_32_28 45_32_32 45_32_45 45_45_13 45_45_26 45_45_28 45_45_32 45_45_45 55_16_16 55_16_29 55_16_55 55_29_16 55_29_29 55_29_32 55_29_55 55_32_29 55_32_32 55_32_55 55_55_16 55_55_29 55_55_32 55_55_55"

RUNS1="${RUNS0} 55_55_55 64_64_64"

RUNS2="${RUNS1} 78_78_78"

RUNS3="4_4_4 4_4_5 4_4_7 4_4_9 4_4_13 4_4_25 4_4_26 4_4_28 4_4_32 4_4_45 4_5_4 4_5_5 4_5_7 4_5_9 4_5_13 4_5_25 4_5_26 4_5_28 4_5_32 4_5_45 4_7_4 4_7_5 4_7_7 4_7_9 4_7_13 4_7_25 4_7_26 4_7_28 4_7_32 4_7_45 4_9_4 4_9_5 4_9_7 4_9_9 4_9_13 4_9_25 4_9_26 4_9_28 4_9_32 4_9_45 4_13_4 4_13_5 4_13_7 4_13_9 4_13_13 4_13_25 4_13_26 4_13_28 4_13_32 4_13_45 4_25_4 4_25_5 4_25_7 4_25_9 4_25_13 4_25_25 4_25_26 4_25_28 4_25_32 4_25_45 4_26_4 4_26_5 4_26_7 4_26_9 4_26_13 4_26_25 4_26_26 4_26_28 4_26_32 4_26_45 4_28_4 4_28_5 4_28_7 4_28_9 4_28_13 4_28_25 4_28_26 4_28_28 4_28_32 4_28_45 4_32_4 4_32_5 4_32_7 4_32_9 4_32_13 4_32_25 4_32_26 4_32_28 4_32_32 4_32_45 4_45_4 4_45_5 4_45_7 4_45_9 4_45_13 4_45_25 4_45_26 4_45_28 4_45_32 4_45_45 5_4_4 5_4_5 5_4_7 5_4_9 5_4_13 5_4_25 5_4_26 5_4_28 5_4_32 5_4_45 5_5_4 5_5_5 5_5_7 5_5_9 5_5_13 5_5_24 5_5_25 5_5_26 5_5_28 5_5_32 5_5_45 5_7_4 5_7_5 5_7_7 5_7_9 5_7_13 5_7_25 5_7_26 5_7_28 5_7_32 5_7_45 5_9_4 5_9_5 5_9_7 5_9_9 5_9_13 5_9_25 5_9_26 5_9_28 5_9_32 5_9_45 5_13_4 5_13_5 5_13_7 5_13_9 5_13_13 5_13_24 5_13_25 5_13_26 5_13_28 5_13_32 5_13_45 5_24_5 5_24_13 5_24_24 5_24_26 5_24_32 5_25_4 5_25_5 5_25_7 5_25_9 5_25_13 5_25_25 5_25_26 5_25_28 5_25_32 5_25_45 5_26_4 5_26_5 5_26_7 5_26_9 5_26_13 5_26_24 5_26_25 5_26_26 5_26_28 5_26_32 5_26_45 5_28_4 5_28_5 5_28_7 5_28_9 5_28_13 5_28_25 5_28_26 5_28_28 5_28_32 5_28_45 5_32_4 5_32_5 5_32_7 5_32_9 5_32_13 5_32_24 5_32_25 5_32_26 5_32_28 5_32_32 5_32_45 5_45_4 5_45_5 5_45_7 5_45_9 5_45_13 5_45_25 5_45_26 5_45_28 5_45_32 5_45_45 6_6_6 7_4_4 7_4_5 7_4_7 7_4_9 7_4_13 7_4_25 7_4_26 7_4_28 7_4_32 7_4_45 7_5_4 7_5_5 7_5_7 7_5_9 7_5_13 7_5_25 7_5_26 7_5_28 7_5_32 7_5_45 7_7_4 7_7_5 7_7_7 7_7_9 7_7_13 7_7_25 7_7_26 7_7_28 7_7_32 7_7_45 7_9_4 7_9_5 7_9_7 7_9_9 7_9_13 7_9_25 7_9_26 7_9_28 7_9_32 7_9_45 7_13_4 7_13_5 7_13_7 7_13_9 7_13_13 7_13_25 7_13_26 7_13_28 7_13_32 7_13_45 7_25_4 7_25_5 7_25_7 7_25_9 7_25_13 7_25_25 7_25_26 7_25_28 7_25_32 7_25_45 7_26_4 7_26_5 7_26_7 7_26_9 7_26_13 7_26_25 7_26_26 7_26_28 7_26_32 7_26_45 7_28_4 7_28_5 7_28_7 7_28_9 7_28_13 7_28_25 7_28_26 7_28_28 7_28_32 7_28_45 7_32_4 7_32_5 7_32_7 7_32_9 7_32_13 7_32_25 7_32_26 7_32_28 7_32_32 7_32_45 7_45_4 7_45_5 7_45_7 7_45_9 7_45_13 7_45_25 7_45_26 7_45_28 7_45_32 7_45_45 9_4_4 9_4_5 9_4_7 9_4_9 9_4_13 9_4_25 9_4_26 9_4_28 9_4_32 9_4_45 9_5_4 9_5_5 9_5_7 9_5_9 9_5_13 9_5_25 9_5_26 9_5_28 9_5_32 9_5_45 9_7_4 9_7_5 9_7_7 9_7_9 9_7_13 9_7_25 9_7_26 9_7_28 9_7_32 9_7_45 9_9_4 9_9_5 9_9_7 9_9_9 9_9_13 9_9_22 9_9_25 9_9_26 9_9_28 9_9_32 9_9_45 9_13_4 9_13_5 9_13_7 9_13_9 9_13_13 9_13_25 9_13_26 9_13_28 9_13_32 9_13_45 9_22_9 9_22_22 9_22_32 9_25_4 9_25_5 9_25_7 9_25_9 9_25_13 9_25_25 9_25_26 9_25_28 9_25_32 9_25_45 9_26_4 9_26_5 9_26_7 9_26_9 9_26_13 9_26_25 9_26_26 9_26_28 9_26_32 9_26_45 9_28_4 9_28_5 9_28_7 9_28_9 9_28_13 9_28_25 9_28_26 9_28_28 9_28_32 9_28_45 9_32_4 9_32_5 9_32_7 9_32_9 9_32_13 9_32_22 9_32_25 9_32_26 9_32_28 9_32_32 9_32_45 9_45_4 9_45_5 9_45_7 9_45_9 9_45_13 9_45_25 9_45_26 9_45_28 9_45_32 9_45_45 12_12_12 13_4_4 13_4_5 13_4_7 13_4_9 13_4_13 13_4_25 13_4_26 13_4_28 13_4_32 13_4_45 13_5_4 13_5_5 13_5_7 13_5_9 13_5_13 13_5_24 13_5_25 13_5_26 13_5_28 13_5_32 13_5_45 13_7_4 13_7_5 13_7_7 13_7_9 13_7_13 13_7_25 13_7_26 13_7_28 13_7_32 13_7_45 13_9_4 13_9_5 13_9_7 13_9_9 13_9_13 13_9_25 13_9_26 13_9_28 13_9_32 13_9_45 13_13_4 13_13_5 13_13_7 13_13_9 13_13_13 13_13_24 13_13_25 13_13_26 13_13_28 13_13_32 13_13_45 13_24_5 13_24_13 13_24_24 13_24_26 13_24_32 13_25_4 13_25_5 13_25_7 13_25_9 13_25_13 13_25_25 13_25_26 13_25_28 13_25_32 13_25_45 13_26_4 13_26_5 13_26_7 13_26_9 13_26_13 13_26_24 13_26_25 13_26_26 13_26_28 13_26_32 13_26_45 13_28_4 13_28_5 13_28_7 13_28_9 13_28_13 13_28_25 13_28_26 13_28_28 13_28_32 13_28_45 13_32_4 13_32_5 13_32_7 13_32_9 13_32_13 13_32_24 13_32_25 13_32_26 13_32_28 13_32_32 13_32_45 13_45_4 13_45_5 13_45_7 13_45_9 13_45_13 13_45_25 13_45_26 13_45_28 13_45_32 13_45_45 14_14_14 14_14_16 14_14_29 14_14_32 14_16_14 14_16_16 14_16_29 14_29_14 14_29_16 14_29_29 14_29_32 14_32_14 14_32_29 14_32_32 16_14_14 16_14_16 16_14_29 16_16_14 16_16_16 16_16_29 16_16_55 16_29_14 16_29_16 16_29_29 16_29_55 16_55_16 16_55_29 16_55_55 22_9_9 22_9_22 22_9_32 22_22_9 22_22_22 22_22_32 22_32_9 22_32_22 22_32_32 23_23_23 24_5_5 24_5_13 24_5_24 24_5_26 24_5_32 24_13_5 24_13_13 24_13_24 24_13_26 24_13_32 24_24_5 24_24_13 24_24_24 24_24_26 24_24_32 24_26_5 24_26_13 24_26_24 24_26_26 24_26_32 24_32_5 24_32_13 24_32_24 24_32_26 24_32_32 25_4_4 25_4_5 25_4_7 25_4_9 25_4_13 25_4_25 25_4_26 25_4_28 25_4_32 25_4_45 25_5_4 25_5_5 25_5_7 25_5_9 25_5_13 25_5_25 25_5_26 25_5_28 25_5_32 25_5_45 25_7_4 25_7_5 25_7_7 25_7_9 25_7_13 25_7_25 25_7_26 25_7_28 25_7_32 25_7_45 25_9_4 25_9_5 25_9_7 25_9_9 25_9_13 25_9_25 25_9_26 25_9_28 25_9_32 25_9_45 25_13_4 25_13_5 25_13_7 25_13_9 25_13_13 25_13_25 25_13_26 25_13_28 25_13_32 25_13_45 25_25_4 25_25_5 25_25_7 25_25_9 25_25_13 25_25_25 25_25_26 25_25_28 25_25_32 25_25_45 25_26_4 25_26_5 25_26_7 25_26_9 25_26_13 25_26_25 25_26_26 25_26_28 25_26_32 25_26_45 25_28_4 25_28_5 25_28_7 25_28_9 25_28_13 25_28_25 25_28_26 25_28_28 25_28_32 25_28_45 25_32_4 25_32_5 25_32_7 25_32_9 25_32_13 25_32_25 25_32_26 25_32_28 25_32_32 25_32_45 25_45_4 25_45_5 25_45_7 25_45_9 25_45_13 25_45_25 25_45_26 25_45_28 25_45_32 25_45_45 26_4_4 26_4_5 26_4_7 26_4_9 26_4_13 26_4_25 26_4_26 26_4_28 26_4_32 26_4_45 26_5_4 26_5_5 26_5_7 26_5_9 26_5_13 26_5_24 26_5_25 26_5_26 26_5_28 26_5_32 26_5_45 26_7_4 26_7_5 26_7_7 26_7_9 26_7_13 26_7_25 26_7_26 26_7_28 26_7_32 26_7_45 26_9_4 26_9_5 26_9_7 26_9_9 26_9_13 26_9_25 26_9_26 26_9_28 26_9_32 26_9_45 26_13_4 26_13_5 26_13_7 26_13_9 26_13_13 26_13_24 26_13_25 26_13_26 26_13_28 26_13_32 26_13_45 26_24_5 26_24_13 26_24_24 26_24_26 26_24_32 26_25_4 26_25_5 26_25_7 26_25_9 26_25_13 26_25_25 26_25_26 26_25_28 26_25_32 26_25_45 26_26_4 26_26_5 26_26_7 26_26_9 26_26_13 26_26_24 26_26_25 26_26_26 26_26_28 26_26_32 26_26_45 26_28_4 26_28_5 26_28_7 26_28_9 26_28_13 26_28_25 26_28_26 26_28_28 26_28_32 26_28_45 26_32_4 26_32_5 26_32_7 26_32_9 26_32_13 26_32_24 26_32_25 26_32_26 26_32_28 26_32_32 26_32_45 26_45_4 26_45_5 26_45_7 26_45_9 26_45_13 26_45_25 26_45_26 26_45_28 26_45_32 26_45_45 28_4_4 28_4_5 28_4_7 28_4_9 28_4_13 28_4_25 28_4_26 28_4_28 28_4_32 28_4_45 28_5_4 28_5_5 28_5_7 28_5_9 28_5_13 28_5_25 28_5_26 28_5_28 28_5_32 28_5_45 28_7_4 28_7_5 28_7_7 28_7_9 28_7_13 28_7_25 28_7_26 28_7_28 28_7_32 28_7_45 28_9_4 28_9_5 28_9_7 28_9_9 28_9_13 28_9_25 28_9_26 28_9_28 28_9_32 28_9_45 28_13_4 28_13_5 28_13_7 28_13_9 28_13_13 28_13_25 28_13_26 28_13_28 28_13_32 28_13_45 28_25_4 28_25_5 28_25_7 28_25_9 28_25_13 28_25_25 28_25_26 28_25_28 28_25_32 28_25_45 28_26_4 28_26_5 28_26_7 28_26_9 28_26_13 28_26_25 28_26_26 28_26_28 28_26_32 28_26_45 28_28_4 28_28_5 28_28_7 28_28_9 28_28_13 28_28_25 28_28_26 28_28_28 28_28_32 28_28_45 28_32_4 28_32_5 28_32_7 28_32_9 28_32_13 28_32_25 28_32_26 28_32_28 28_32_32 28_32_45 28_45_4 28_45_5 28_45_7 28_45_9 28_45_13 28_45_25 28_45_26 28_45_28 28_45_32 28_45_45 29_14_14 29_14_16 29_14_29 29_14_32 29_16_14 29_16_16 29_16_29 29_16_55 29_29_14 29_29_16 29_29_29 29_29_32 29_29_55 29_32_14 29_32_29 29_32_32 29_32_55 29_55_16 29_55_29 29_55_32 29_55_55 32_4_4 32_4_5 32_4_7 32_4_9 32_4_13 32_4_25 32_4_26 32_4_28 32_4_32 32_4_45 32_5_4 32_5_5 32_5_7 32_5_9 32_5_13 32_5_24 32_5_25 32_5_26 32_5_28 32_5_32 32_5_45 32_7_4 32_7_5 32_7_7 32_7_9 32_7_13 32_7_25 32_7_26 32_7_28 32_7_32 32_7_45 32_9_4 32_9_5 32_9_7 32_9_9 32_9_13 32_9_22 32_9_25 32_9_26 32_9_28 32_9_32 32_9_45 32_13_4 32_13_5 32_13_7 32_13_9 32_13_13 32_13_24 32_13_25 32_13_26 32_13_28 32_13_32 32_13_45 32_14_14 32_14_29 32_14_32 32_22_9 32_22_22 32_22_32 32_24_5 32_24_13 32_24_24 32_24_26 32_24_32 32_25_4 32_25_5 32_25_7 32_25_9 32_25_13 32_25_25 32_25_26 32_25_28 32_25_32 32_25_45 32_26_4 32_26_5 32_26_7 32_26_9 32_26_13 32_26_24 32_26_25 32_26_26 32_26_28 32_26_32 32_26_45 32_28_4 32_28_5 32_28_7 32_28_9 32_28_13 32_28_25 32_28_26 32_28_28 32_28_32 32_28_45 32_29_14 32_29_29 32_29_32 32_29_55 32_32_4 32_32_5 32_32_7 32_32_9 32_32_13 32_32_14 32_32_22 32_32_24 32_32_25 32_32_26 32_32_28 32_32_29 32_32_32 32_32_45 32_32_55 32_45_4 32_45_5 32_45_7 32_45_9 32_45_13 32_45_25 32_45_26 32_45_28 32_45_32 32_45_45 32_55_29 32_55_32 32_55_55 45_4_4 45_4_5 45_4_7 45_4_9 45_4_13 45_4_25 45_4_26 45_4_28 45_4_32 45_4_45 45_5_4 45_5_5 45_5_7 45_5_9 45_5_13 45_5_25 45_5_26 45_5_28 45_5_32 45_5_45 45_7_4 45_7_5 45_7_7 45_7_9 45_7_13 45_7_25 45_7_26 45_7_28 45_7_32 45_7_45 45_9_4 45_9_5 45_9_7 45_9_9 45_9_13 45_9_25 45_9_26 45_9_28 45_9_32 45_9_45 45_13_4 45_13_5 45_13_7 45_13_9 45_13_13 45_13_25 45_13_26 45_13_28 45_13_32 45_13_45 45_25_4 45_25_5 45_25_7 45_25_9 45_25_13 45_25_25 45_25_26 45_25_28 45_25_32 45_25_45 45_26_4 45_26_5 45_26_7 45_26_9 45_26_13 45_26_25 45_26_26 45_26_28 45_26_32 45_26_45 45_28_4 45_28_5 45_28_7 45_28_9 45_28_13 45_28_25 45_28_26 45_28_28 45_28_32 45_28_45 45_32_4 45_32_5 45_32_7 45_32_9 45_32_13 45_32_25 45_32_26 45_32_28 45_32_32 45_32_45 45_45_4 45_45_5 45_45_7 45_45_9 45_45_13 45_45_25 45_45_26 45_45_28 45_45_32 45_45_45 55_16_16 55_16_29 55_16_55 55_29_16 55_29_29 55_29_32 55_29_55 55_32_29 55_32_32 55_32_55 55_55_16 55_55_29 55_55_32 55_55_55 64_64_64 78_78_78"

case "$1" in
  "-"*) RUNS=RUNS${1:1}; shift
  ;;
esac

if [ "" = "${!RUNS}" ]; then
  RUNS=RUNS3
fi

if [ "" != "$1" ]; then
  FILE=$1
  shift
fi
if [ "" != "$1" ]; then
  SIZE=$1
  shift
else
  SIZE=0
fi
cat /dev/null > ${FILE}

NRUN=1
NMAX=$(${ECHO} ${!RUNS} | wc -w)
for RUN in ${!RUNS} ; do
  MVALUE=$(${ECHO} ${RUN} | cut --output-delimiter=' ' -d_ -f1)
  NVALUE=$(${ECHO} ${RUN} | cut --output-delimiter=' ' -d_ -f2)
  KVALUE=$(${ECHO} ${RUN} | cut --output-delimiter=' ' -d_ -f3)
  >&2 ${ECHO} -n "${NRUN} of ${NMAX} (M=${MVALUE} N=${NVALUE} K=${KVALUE})... "
  ERROR=$({ CHECK=1 ${HERE}/cp2k.sh ${MVALUE} ${SIZE} 0 ${NVALUE} ${KVALUE} >> ${FILE}; } 2>&1)
  RESULT=$?
  if [ 0 != ${RESULT} ]; then
    ${ECHO} "FAILED(${RESULT}) ${ERROR}"
    exit 1
  else
    ${ECHO} "OK ${ERROR}"
  fi
  ${ECHO} >> ${FILE}
  NRUN=$((NRUN+1))
done

