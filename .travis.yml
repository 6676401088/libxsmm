language: cpp

sudo: false

addons:
  apt:
    packages:
    - gfortran
    - libblas-dev
    - liblapack-dev

before_install:
  - pip install --user codecov

after_success:
  - source .codecov && 
    eval ${LIBXSMM_RUNGCOV} &&
    eval ${LIBXSMM_CODECOV}

compiler:
  - clang
  - gcc

env:
  - LIBXSMM_JIT=0
  - LIBXSMM_JIT=1

script:
  - cd ${TRAVIS_BUILD_DIR} &&
    source .codecov &&
    make -e clean && make -e &&
    cd ${TRAVIS_BUILD_DIR}/tests &&
    make ECFLAGS=-DREAL_TYPE=float test

  - cd ${TRAVIS_BUILD_DIR} &&
    source .codecov &&
    make -e clean && make -e &&
    cd ${TRAVIS_BUILD_DIR}/tests &&
    make test

  - cd ${TRAVIS_BUILD_DIR} &&
    source .codecov &&
    make -e clean &&
    bash make.sh -ci-cm -j test-cp2k

  - cd ${TRAVIS_BUILD_DIR} &&
    source .codecov &&
    make -e clean &&
    bash make.sh -ci-cm -j test-smm

  - cd ${TRAVIS_BUILD_DIR} &&
    source .codecov &&
    make -e clean &&
    bash make.sh -ci-nek -j test-nek

